{
  endpoint: "/v1/messages",
  schemas: {
    response: "anthropic.MessagesResponse",
    stream_chunk: "anthropic.AnthropicStreamChunk",
  },
  stream_expectations: {
    // Anthropic streaming events are strongly typed; missing any of these is almost certainly a server bug.
    min_observations: 1,
    checks: [
      {
        type: "required_sequence",
        values: [
          "message_start",
          "content_block_start",
          // "ping",
          "content_block_delta",
          "content_block_stop",
          "message_delta",
          "message_stop",
        ],
      },
      {
        type: "required_terminal",
        value: "message_stop",
      },
    ],
  },
  tests: [
    {
      name: "baseline",
      description: "Baseline test",
      params: {
        max_tokens: 256,
        messages: [
          {
            role: "user",
            content: "Hello",
          },
        ],
      },
      baseline: true,
    },
    {
      name: "temperature",
      description: "Test temperature parameter",
      params: {
        temperature: 0.7,
      },
      focus_param: {
        name: "temperature",
        value: 0.7,
      },
    },
    {
      name: "top_p",
      description: "Test top_p parameter",
      params: {
        top_p: 0.9,
      },
      focus_param: {
        name: "top_p",
        value: 0.9,
      },
    },
    {
      name: "top_k",
      description: "Test top_k parameter",
      params: {
        top_k: 40,
      },
      focus_param: {
        name: "top_k",
        value: 40,
      },
    },
    {
      name: "stop_sequences",
      description: "Test stop_sequences parameter",
      params: {
        stop_sequences: [
          "StopHere",
          "EndProcess",
        ],
      },
      focus_param: {
        name: "stop_sequences",
        value: [
          "StopHere",
          "EndProcess",
        ],
      },
    },
    {
      name: "system",
      description: "Test system parameter",
      params: {
        system: "You are a helpful assistant.",
      },
      focus_param: {
        name: "system",
        value: "You are a helpful assistant.",
      },
    },
    {
      name: "metadata",
      description: "Test metadata parameter",
      params: {
        metadata: {
          user_id: "test-user-123",
        },
      },
      focus_param: {
        name: "metadata",
        value: {
          user_id: "test-user-123",
        },
      },
    },
    {
      name: "image.source.media_type",
      description: "Test different image media_type with valid headers",
      variants: {
        image_data: [
          {
            variant_id: "jpeg",
            media_type: "image/jpeg",
            data: "$asset_base64(assets/images/1x1.jpg)",
          },
          {
            variant_id: "png",
            media_type: "image/png",
            data: "$asset_base64(assets/images/1x1.png)",
          },
          {
            variant_id: "gif",
            media_type: "image/gif",
            data: "$asset_base64(assets/images/1x1.gif)",
          },
          {
            variant_id: "webp",
            media_type: "image/webp",
            data: "$asset_base64(assets/images/1x1.webp)",
          },
        ],
      },
      params: {
        max_tokens: 256,
        messages: [
          {
            role: "user",
            content: [
              {
                type: "image",
                source: {
                  type: "base64",
                  media_type: "$image_data.media_type",
                  data: "$image_data.data",
                },
              },
              {
                type: "text",
                text: "Describe this image.",
              },
            ],
          },
        ],
      },
      focus_param: {
        name: "image.source.media_type",
        value: "$image_data.media_type",
      },
    },
    {
      name: "tools",
      description: "Test tools parameter",
      params: {
        tools: [
          {
            name: "get_weather",
            description: "Get weather",
            input_schema: {
              type: "object",
              properties: {
                location: {
                  type: "string",
                },
              },
              required: [
                "location",
              ],
            },
          },
        ],
        messages: [
          {
            role: "user",
            content: "Weather in SF?",
          },
        ],
      },
      focus_param: {
        name: "tools",
        value: [
          {
            name: "get_weather",
            description: "Get weather",
            input_schema: {
              type: "object",
              properties: {
                location: {
                  type: "string",
                },
              },
              required: [
                "location",
              ],
            },
          },
        ],
      },
    },
    {
      name: "tool_choice",
      description: "Test tool_choice variants",
      variants: {
        choice: [
          {
            variant_id: "auto",
            type: "auto",
          },
          {
            variant_id: "any",
            type: "any",
          },
          {
            variant_id: "tool",
            type: "tool",
            name: "get_weather",
          },
        ],
      },
      params: {
        tools: [
          {
            name: "get_weather",
            description: "Get weather",
            input_schema: {
              type: "object",
              properties: {
                location: {
                  type: "string",
                },
              },
              required: [
                "location",
              ],
            },
          },
        ],
        tool_choice: "$choice",
        messages: [
          {
            role: "user",
            content: "Weather?",
          },
        ],
      },
      focus_param: {
        name: "tool_choice",
        value: "$choice",
      },
    },
    {
      name: "thinking.type",
      description: "Test thinking parameter",
      params: {
        max_tokens: 2560,
        thinking: {
          type: "enabled",
          budget_tokens: 2048,
        },
        messages: [
          {
            role: "user",
            content: "Solve 25 * 17",
          },
        ],
      },
      focus_param: {
        name: "thinking.type",
        value: "enabled",
      },
    },
    {
      name: "stream",
      description: "Basic streaming response test",
      check_stream: true,
      params: {
        stream: true,
      },
      focus_param: {
        name: "stream",
        value: true,
      },
    },
    // {
    //   name: "test_streaming_tool_use",
    //   description: "Streaming tool use test",
    //   stream: true,
    //   params: {
    //     stream: true,
    //     tools: [
    //       {
    //         name: "get_weather",
    //         description: "Get the current weather in a given location",
    //         input_schema: {
    //           type: "object",
    //           properties: {
    //             location: {
    //               type: "string",
    //               description: "The city and state, e.g. San Francisco, CA",
    //             },
    //           },
    //           required: [
    //             "location",
    //           ],
    //         },
    //       },
    //     ],
    //     tool_choice: {
    //       type: "any",
    //     },
    //     messages: [
    //       {
    //         role: "user",
    //         content: "What is the weather like in San Francisco?",
    //       },
    //     ],
    //   },
    //   focus_param: {
    //     name: "stream",
    //     value: true,
    //   },
    // },
    // {
    //   name: "test_streaming_extended_thinking",
    //   description: "Streaming extended thinking test",
    //   stream: true,
    //   params: {
    //     stream: true,
    //     max_tokens: 20000,
    //     thinking: {
    //       type: "enabled",
    //       budget_tokens: 16000,
    //     },
    //     messages: [
    //       {
    //         role: "user",
    //         content: "What is the greatest common divisor of 1071 and 462?",
    //       },
    //     ],
    //   },
    //   focus_param: {
    //     name: "stream",
    //     value: true,
    //   },
    // },
    // {
    //   name: "test_streaming_web_search_tool_use",
    //   description: "Streaming web search tool use test",
    //   stream: true,
    //   params: {
    //     stream: true,
    //     tools: [
    //       {
    //         type: "web_search_20250305",
    //         name: "web_search",
    //         max_uses: 5,
    //       },
    //     ],
    //     messages: [
    //       {
    //         role: "user",
    //         content: "What is the weather like in New York City today?",
    //       },
    //     ],
    //   },
    //   focus_param: {
    //     name: "stream",
    //     value: true,
    //   },
    // },
  ],
}
