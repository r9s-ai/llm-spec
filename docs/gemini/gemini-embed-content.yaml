openapi: 3.1.0
info:
  title: Google Gemini EmbedContent API
  version: v1beta
  description: |
    Gemini API的EmbedContent端点，用于生成文本和多模态内容的嵌入向量。

    支持的功能：
    - 文本嵌入
    - 多种任务类型优化（检索、分类、聚类等）
    - 自定义输出维度
    - 批量嵌入

  contact:
    name: Google AI
    url: https://ai.google.dev/

  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: https://generativelanguage.googleapis.com/v1beta
    description: Gemini API v1beta endpoint

security:
  - ApiKeyHeader: []

paths:
  /models/{model}:embedContent:
    post:
      operationId: embedContent
      summary: 生成嵌入向量
      description: |
        为给定的内容生成嵌入向量。支持文本和多模态内容。

      parameters:
        - name: model
          in: path
          required: true
          description: 嵌入模型名称
          schema:
            type: string
            examples:
              - text-embedding-004
              - embedding-001

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmbedContentRequest'
            examples:
              simpleText:
                summary: 简单文本嵌入
                value:
                  content:
                    parts:
                      - text: "What is the meaning of life?"

              retrievalQuery:
                summary: 检索查询
                value:
                  content:
                    parts:
                      - text: "How to bake a chocolate cake?"
                  taskType: RETRIEVAL_QUERY

              retrievalDocument:
                summary: 检索文档（带标题）
                value:
                  content:
                    parts:
                      - text: "A chocolate cake is a cake flavored with melted chocolate..."
                  taskType: RETRIEVAL_DOCUMENT
                  title: "Chocolate Cake Recipe"

              customDimension:
                summary: 自定义输出维度
                value:
                  content:
                    parts:
                      - text: "Machine learning is a subset of AI"
                  taskType: SEMANTIC_SIMILARITY
                  outputDimensionality: 256

      responses:
        '200':
          description: 成功生成嵌入向量
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbedContentResponse'
              examples:
                success:
                  summary: 成功响应
                  value:
                    embedding:
                      values:
                        - 0.123
                        - -0.456
                        - 0.789
                        # ... 768维向量

        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

        '429':
          description: 速率限制
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /models/{model}:batchEmbedContents:
    post:
      operationId: batchEmbedContents
      summary: 批量生成嵌入向量
      description: |
        为多个内容批量生成嵌入向量。

      parameters:
        - name: model
          in: path
          required: true
          description: 嵌入模型名称
          schema:
            type: string

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchEmbedContentsRequest'
            examples:
              batch:
                summary: 批量嵌入
                value:
                  requests:
                    - content:
                        parts:
                          - text: "First document"
                      taskType: RETRIEVAL_DOCUMENT
                    - content:
                        parts:
                          - text: "Second document"
                      taskType: RETRIEVAL_DOCUMENT

      responses:
        '200':
          description: 成功生成批量嵌入向量
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchEmbedContentsResponse'

components:
  securitySchemes:
    ApiKeyHeader:
      type: apiKey
      in: header
      name: x-goog-api-key
      description: Google AI API Key

  schemas:
    EmbedContentRequest:
      type: object
      required:
        - content
      properties:
        content:
          $ref: '#/components/schemas/Content'
          description: 要嵌入的内容

        taskType:
          $ref: '#/components/schemas/TaskType'

        title:
          type: string
          description: |
            文档标题（仅在taskType为RETRIEVAL_DOCUMENT时使用）
          maxLength: 1024

        outputDimensionality:
          type: integer
          description: |
            输出向量的维度（可选）。
            如果不指定，使用模型默认维度。
          minimum: 1
          maximum: 768
          examples:
            - 256
            - 512
            - 768

    Content:
      type: object
      required:
        - parts
      properties:
        parts:
          type: array
          description: 内容部分数组
          items:
            $ref: '#/components/schemas/Part'
        role:
          type: string
          description: 角色（通常为user）

    Part:
      type: object
      description: 内容部分，通常是文本
      properties:
        text:
          type: string
          description: 文本内容
        # 注意：embedContent主要用于文本，不支持所有Part类型

    TaskType:
      type: string
      description: |
        任务类型，用于优化嵌入向量的生成。

        - TASK_TYPE_UNSPECIFIED: 未指定（默认）
        - RETRIEVAL_QUERY: 检索查询（用于搜索查询）
        - RETRIEVAL_DOCUMENT: 检索文档（用于被搜索的文档）
        - SEMANTIC_SIMILARITY: 语义相似度
        - CLASSIFICATION: 分类
        - CLUSTERING: 聚类
        - QUESTION_ANSWERING: 问答
        - FACT_VERIFICATION: 事实验证
        - CODE_RETRIEVAL_QUERY: 代码检索查询
      enum:
        - TASK_TYPE_UNSPECIFIED
        - RETRIEVAL_QUERY
        - RETRIEVAL_DOCUMENT
        - SEMANTIC_SIMILARITY
        - CLASSIFICATION
        - CLUSTERING
        - QUESTION_ANSWERING
        - FACT_VERIFICATION
        - CODE_RETRIEVAL_QUERY

    EmbedContentResponse:
      type: object
      required:
        - embedding
      properties:
        embedding:
          $ref: '#/components/schemas/Embedding'

    Embedding:
      type: object
      required:
        - values
      properties:
        values:
          type: array
          description: 嵌入向量值
          items:
            type: number
            format: float
          minItems: 1
          examples:
            - [0.123, -0.456, 0.789]

    BatchEmbedContentsRequest:
      type: object
      required:
        - requests
      properties:
        requests:
          type: array
          description: 批量嵌入请求列表
          items:
            $ref: '#/components/schemas/EmbedContentRequest'
          minItems: 1
          maxItems: 100

    BatchEmbedContentsResponse:
      type: object
      required:
        - embeddings
      properties:
        embeddings:
          type: array
          description: 嵌入向量列表
          items:
            $ref: '#/components/schemas/Embedding'

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: HTTP状态码
            message:
              type: string
              description: 错误消息
            status:
              type: string
              description: 错误状态
              examples:
                - INVALID_ARGUMENT
                - PERMISSION_DENIED
                - RESOURCE_EXHAUSTED
