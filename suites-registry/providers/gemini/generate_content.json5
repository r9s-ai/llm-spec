{
  provider: "gemini",
  // Official REST endpoint pattern:
  //   POST /v1beta/models/{model}:generateContent
  // Docs: https://ai.google.dev/api
  // Text output model (per repo convention): gemini-3-flash-preview
  endpoint: "/v1beta/models/gemini-3-flash-preview:generateContent",
  schemas: {
    response: "gemini.GenerateContentResponse",
  },
  base_params: {
    contents: [
      {
        role: "user",
        parts: [{ text: "Say hello" }],
      },
    ],
  },
  tests: [
    {
      name: "test_baseline",
      description: "Baseline test: minimal required parameters",
      is_baseline: true,
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_temperature",
      description: "Test generationConfig.temperature",
      params: { generationConfig: { temperature: 0.7 } },
      test_param: { name: "generationConfig.temperature", value: 0.7 },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_max_output_tokens",
      description: "Test generationConfig.maxOutputTokens",
      params: { generationConfig: { maxOutputTokens: 64 } },
      test_param: { name: "generationConfig.maxOutputTokens", value: 64 },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_top_p",
      description: "Test generationConfig.topP",
      params: { generationConfig: { topP: 0.9 } },
      test_param: { name: "generationConfig.topP", value: 0.9 },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_top_k",
      description: "Test generationConfig.topK",
      params: { generationConfig: { topK: 20 } },
      test_param: { name: "generationConfig.topK", value: 20 },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_candidate_count",
      description: "Test generationConfig.candidateCount",
      params: { generationConfig: { candidateCount: 2 } },
      test_param: { name: "generationConfig.candidateCount", value: 2 },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_stop_sequences",
      description: "Test generationConfig.stopSequences",
      params: { generationConfig: { stopSequences: ["END"] } },
      test_param: { name: "generationConfig.stopSequences", value: ["END"] },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_response_mime_type",
      description: "Test generationConfig.responseMimeType (JSON output)",
      params: { generationConfig: { responseMimeType: "application/json" } },
      test_param: { name: "generationConfig.responseMimeType", value: "application/json" },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_response_schema",
      description: "Test generationConfig.responseSchema (JSON schema)",
      params: {
        generationConfig: {
          responseMimeType: "application/json",
          responseSchema: {
            type: "object",
            properties: { greeting: { type: "string" } },
            required: ["greeting"],
          },
        },
      },
      test_param: { name: "generationConfig.responseSchema", value: { type: "object" } },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_system_instruction",
      description: "Test systemInstruction (top-level field)",
      params: {
        systemInstruction: { parts: [{ text: "You are a concise assistant." }] },
        generationConfig: { maxOutputTokens: 64 },
      },
      test_param: { name: "systemInstruction", value: { parts: [{ text: "You are a concise assistant." }] } },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_tools_function_declarations",
      description: "Test tools.functionDeclarations + toolConfig.functionCallingConfig (top-level fields)",
      params: {
        tools: [
          {
            functionDeclarations: [
              {
                name: "get_weather",
                description: "Get weather by city name",
                parameters: {
                  type: "object",
                  properties: { city: { type: "string" } },
                  required: ["city"],
                },
              },
            ],
          },
        ],
        toolConfig: { functionCallingConfig: { mode: "AUTO" } },
        generationConfig: { maxOutputTokens: 64 },
      },
      test_param: { name: "tools.functionDeclarations", value: [{ name: "get_weather" }] },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_tool_call_any",
      description: "Tool calling: force a function call via toolConfig.functionCallingConfig.mode=ANY",
      override_base: true,
      params: {
        contents: [
          {
            role: "user",
            parts: [{ text: "What's the weather in San Francisco?" }],
          },
        ],
        tools: [
          {
            functionDeclarations: [
              {
                name: "get_weather",
                description: "Get weather by city name",
                parameters: {
                  type: "object",
                  properties: { city: { type: "string" } },
                  required: ["city"],
                },
              },
            ],
          },
        ],
        toolConfig: {
          functionCallingConfig: {
            mode: "ANY",
            allowedFunctionNames: ["get_weather"],
          },
        },
        generationConfig: { maxOutputTokens: 64 },
      },
      test_param: { name: "toolConfig.functionCallingConfig.mode", value: "ANY" },
      required_fields: [
        "candidates[0].content.parts[0].functionCall.name",
        "candidates[0].content.parts[0].functionCall.args.city",
      ],
    },
    {
      name: "test_tool_call_none",
      description: "Tool calling: disable tool calls via toolConfig.functionCallingConfig.mode=NONE",
      override_base: true,
      params: {
        contents: [
          {
            role: "user",
            parts: [{ text: "Say hello" }],
          },
        ],
        tools: [
          {
            functionDeclarations: [
              {
                name: "get_weather",
                description: "Get weather by city name",
                parameters: {
                  type: "object",
                  properties: { city: { type: "string" } },
                  required: ["city"],
                },
              },
            ],
          },
        ],
        toolConfig: { functionCallingConfig: { mode: "NONE" } },
        generationConfig: { maxOutputTokens: 64 },
      },
      test_param: { name: "toolConfig.functionCallingConfig.mode", value: "NONE" },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_param_safety_settings",
      description: "Test safetySettings (top-level field)",
      // Parameterize across all documented categories + thresholds.
      // This expands into many variants like:
      //   test_param_safety_settings[HARM_CATEGORY_HARASSMENT:BLOCK_MEDIUM_AND_ABOVE]
      parameterize: {
        setting: [
          { suffix: "HARM_CATEGORY_UNSPECIFIED:BLOCK_NONE", category: "HARM_CATEGORY_UNSPECIFIED", threshold: "BLOCK_NONE" },
          { suffix: "HARM_CATEGORY_UNSPECIFIED:BLOCK_ONLY_HIGH", category: "HARM_CATEGORY_UNSPECIFIED", threshold: "BLOCK_ONLY_HIGH" },
          { suffix: "HARM_CATEGORY_UNSPECIFIED:BLOCK_MEDIUM_AND_ABOVE", category: "HARM_CATEGORY_UNSPECIFIED", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_UNSPECIFIED:BLOCK_LOW_AND_ABOVE", category: "HARM_CATEGORY_UNSPECIFIED", threshold: "BLOCK_LOW_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_UNSPECIFIED:HARM_BLOCK_THRESHOLD_UNSPECIFIED", category: "HARM_CATEGORY_UNSPECIFIED", threshold: "HARM_BLOCK_THRESHOLD_UNSPECIFIED" },

          { suffix: "HARM_CATEGORY_HARASSMENT:BLOCK_NONE", category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
          { suffix: "HARM_CATEGORY_HARASSMENT:BLOCK_ONLY_HIGH", category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_ONLY_HIGH" },
          { suffix: "HARM_CATEGORY_HARASSMENT:BLOCK_MEDIUM_AND_ABOVE", category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_HARASSMENT:BLOCK_LOW_AND_ABOVE", category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_LOW_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_HARASSMENT:HARM_BLOCK_THRESHOLD_UNSPECIFIED", category: "HARM_CATEGORY_HARASSMENT", threshold: "HARM_BLOCK_THRESHOLD_UNSPECIFIED" },

          { suffix: "HARM_CATEGORY_HATE_SPEECH:BLOCK_NONE", category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
          { suffix: "HARM_CATEGORY_HATE_SPEECH:BLOCK_ONLY_HIGH", category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_ONLY_HIGH" },
          { suffix: "HARM_CATEGORY_HATE_SPEECH:BLOCK_MEDIUM_AND_ABOVE", category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_HATE_SPEECH:BLOCK_LOW_AND_ABOVE", category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_LOW_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_HATE_SPEECH:HARM_BLOCK_THRESHOLD_UNSPECIFIED", category: "HARM_CATEGORY_HATE_SPEECH", threshold: "HARM_BLOCK_THRESHOLD_UNSPECIFIED" },

          { suffix: "HARM_CATEGORY_SEXUALLY_EXPLICIT:BLOCK_NONE", category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
          { suffix: "HARM_CATEGORY_SEXUALLY_EXPLICIT:BLOCK_ONLY_HIGH", category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_ONLY_HIGH" },
          { suffix: "HARM_CATEGORY_SEXUALLY_EXPLICIT:BLOCK_MEDIUM_AND_ABOVE", category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_SEXUALLY_EXPLICIT:BLOCK_LOW_AND_ABOVE", category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_LOW_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_SEXUALLY_EXPLICIT:HARM_BLOCK_THRESHOLD_UNSPECIFIED", category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "HARM_BLOCK_THRESHOLD_UNSPECIFIED" },

          { suffix: "HARM_CATEGORY_DANGEROUS_CONTENT:BLOCK_NONE", category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" },
          { suffix: "HARM_CATEGORY_DANGEROUS_CONTENT:BLOCK_ONLY_HIGH", category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_ONLY_HIGH" },
          { suffix: "HARM_CATEGORY_DANGEROUS_CONTENT:BLOCK_MEDIUM_AND_ABOVE", category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_DANGEROUS_CONTENT:BLOCK_LOW_AND_ABOVE", category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_LOW_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_DANGEROUS_CONTENT:HARM_BLOCK_THRESHOLD_UNSPECIFIED", category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "HARM_BLOCK_THRESHOLD_UNSPECIFIED" },

          { suffix: "HARM_CATEGORY_CIVIC_INTEGRITY:BLOCK_NONE", category: "HARM_CATEGORY_CIVIC_INTEGRITY", threshold: "BLOCK_NONE" },
          { suffix: "HARM_CATEGORY_CIVIC_INTEGRITY:BLOCK_ONLY_HIGH", category: "HARM_CATEGORY_CIVIC_INTEGRITY", threshold: "BLOCK_ONLY_HIGH" },
          { suffix: "HARM_CATEGORY_CIVIC_INTEGRITY:BLOCK_MEDIUM_AND_ABOVE", category: "HARM_CATEGORY_CIVIC_INTEGRITY", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_CIVIC_INTEGRITY:BLOCK_LOW_AND_ABOVE", category: "HARM_CATEGORY_CIVIC_INTEGRITY", threshold: "BLOCK_LOW_AND_ABOVE" },
          { suffix: "HARM_CATEGORY_CIVIC_INTEGRITY:HARM_BLOCK_THRESHOLD_UNSPECIFIED", category: "HARM_CATEGORY_CIVIC_INTEGRITY", threshold: "HARM_BLOCK_THRESHOLD_UNSPECIFIED" },
        ],
      },
      params: {
        safetySettings: ["$setting"],
        generationConfig: { maxOutputTokens: 64 },
      },
      test_param: { name: "safetySettings", value: ["$setting"] },
      required_fields: ["candidates[0].content.parts[0].text"],
    },
    {
      name: "test_image_output",
      description: "Test image modality output (TEXT+IMAGE) using gemini-3-flash-image",
      endpoint_override: "/v1beta/models/gemini-3-flash-image:generateContent",
      // Multimodal response generation: must explicitly request IMAGE.
      // See: https://ai.google.dev/gemini-api/docs/image-generation
      params: { generationConfig: { responseModalities: ["TEXT", "IMAGE"] } },
      test_param: { name: "generationConfig.responseModalities", value: ["TEXT", "IMAGE"] },
      required_fields: [
        "candidates[0].content.parts[0].inlineData.data",
        "candidates[0].content.parts[0].inlineData.mimeType",
      ],
    },
  ],
}
