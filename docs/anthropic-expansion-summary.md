# Anthropic Messages API æµ‹è¯•æ‰©å±•æ€»ç»“

## ğŸ“Š æ‰©å±•æˆæœ

### è§„æ¨¡å¯¹æ¯”

| æŒ‡æ ‡ | æ‰©å±•å‰ | æ‰©å±•å | å¢é•¿ç‡ |
|------|--------|--------|--------|
| æµ‹è¯•æ–‡ä»¶æ•° | 1ä¸ª | 4ä¸ª | +300% |
| ä»£ç è¡Œæ•° | 144è¡Œ | 2479è¡Œ | +1621% |
| æµ‹è¯•æ•°é‡ | 3ä¸ª | 48ä¸ª | +1500% |

### æ–‡ä»¶ç»“æ„

```
tests/anthropic/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ test_messages_basic.py        # 539è¡Œ, 13ä¸ªæµ‹è¯•
â”œâ”€â”€ test_messages_advanced.py     # 572è¡Œ, 13ä¸ªæµ‹è¯•
â”œâ”€â”€ test_messages_tools.py        # 734è¡Œ, 12ä¸ªæµ‹è¯•
â””â”€â”€ test_messages_streaming.py    # 634è¡Œ, 10ä¸ªæµ‹è¯•
```

---

## ğŸ¯ æµ‹è¯•è¦†ç›–è¯¦æƒ…

### test_messages_basic.py (åŸºç¡€å‚æ•°æµ‹è¯•)

**13ä¸ªæµ‹è¯•ï¼Œæ¶µç›–ï¼š**
- âœ… åŸºçº¿æµ‹è¯•
- âœ… 5ä¸ªæ¨¡å‹å˜ä½“æµ‹è¯•
- âœ… é‡‡æ ·å‚æ•°ï¼ˆtemperature, top_p, top_k, combinedï¼‰
- âœ… åœæ­¢æ§åˆ¶ï¼ˆstop_sequences, max_tokensè¾¹ç•Œï¼‰
- âœ… ç³»ç»Ÿæç¤ºï¼ˆåŸºç¡€ã€å¤šè¡Œã€å¤æ‚æŒ‡ä»¤ï¼‰
- âœ… å…ƒæ•°æ®è¿½è¸ª

### test_messages_advanced.py (é«˜çº§å‚æ•°ä¸å¤šæ¨¡æ€)

**13ä¸ªæµ‹è¯•ï¼Œæ¶µç›–ï¼š**
- âœ… å¤šè½®å¯¹è¯ï¼ˆ3ä¸ªåœºæ™¯ï¼‰
- âœ… å¤šæ¨¡æ€å†…å®¹ï¼ˆbase64å›¾ç‰‡ã€4ç§æ ¼å¼ã€æ··åˆå†…å®¹ï¼‰
- âœ… å†…å®¹å—æ ¼å¼ï¼ˆå­—ç¬¦ä¸²ã€å—æ•°ç»„ã€å¤šæ–‡æœ¬å—ï¼‰
- âœ… æ€è€ƒæ¨¡å¼ï¼ˆClaude 3.7+ç‰¹æ€§ï¼‰

### test_messages_tools.py (å·¥å…·è°ƒç”¨)

**12ä¸ªæµ‹è¯•ï¼Œæ¶µç›–ï¼š**
- âœ… åŸºç¡€å·¥å…·è°ƒç”¨ä¸å“åº”éªŒè¯
- âœ… å·¥å…·é€‰æ‹©ç­–ç•¥ï¼ˆauto/any/specificï¼‰
- âœ… å¤æ‚åœºæ™¯ï¼ˆå¤šå·¥å…·ã€å¤æ‚schemaã€å¹¶è¡Œè°ƒç”¨ã€å¤šè½®å¯¹è¯ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆis_erroræ ‡å¿—ï¼‰

### test_messages_streaming.py (æµå¼å“åº”)

**10ä¸ªæµ‹è¯•ï¼Œæ¶µç›–ï¼š**
- âœ… åŸºç¡€æµå¼å“åº”ä¸äº‹ä»¶ç±»å‹éªŒè¯
- âœ… å†…å®¹éªŒè¯ï¼ˆæ–‡æœ¬ç´¯ç§¯ã€usageç»Ÿè®¡ã€stop_reasonï¼‰
- âœ… æµå¼å·¥å…·è°ƒç”¨ï¼ˆtool_useã€input_json_deltaï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆerroräº‹ä»¶ã€pingäº‹ä»¶ï¼‰

---

## ğŸ† ä¸å…¶ä»–Providerå¯¹æ¯”

| Provider | æµ‹è¯•æ–‡ä»¶ | æ€»è¡Œæ•° | æµ‹è¯•æ•°é‡ | è¦†ç›–ç‡ |
|----------|---------|--------|---------|--------|
| OpenAI | 7ä¸ª | ~4000è¡Œ | 40+ä¸ª | â­â­â­â­ |
| Gemini | 3ä¸ª | ~1200è¡Œ | 32ä¸ª | â­â­â­â­ |
| **Anthropic** | **4ä¸ª** | **2479è¡Œ** | **48ä¸ª** | â­â­â­â­â­ |

**Anthropic ç°åœ¨æ‹¥æœ‰æœ€å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼**

---

## ğŸ“ å®ç°äº®ç‚¹

1. **å®Œæ•´çš„æ§åˆ¶å˜é‡æ³•** - æ¯ä¸ªæµ‹è¯•åªæµ‹è¯•ä¸€ä¸ªæ–°å‚æ•°
2. **å……åˆ†åˆ©ç”¨Schema** - ä½¿ç”¨å·²æœ‰çš„å®Œæ•´Pydanticæ¨¡å‹
3. **å·¥å…·è°ƒç”¨æ·±åº¦è¦†ç›–** - 12ä¸ªæµ‹è¯•æ¶µç›–æ‰€æœ‰å·¥å…·åœºæ™¯
4. **æµå¼å“åº”å®Œæ•´éªŒè¯** - SSEäº‹ä»¶è§£æå’Œ7ç§äº‹ä»¶ç±»å‹
5. **å¤šæ¨¡æ€æ”¯æŒ** - å›¾ç‰‡è¾“å…¥ã€å¤šç§media_type
6. **æ€è€ƒæ¨¡å¼æ”¯æŒ** - Claude 3.7+çš„Extended Thinkingç‰¹æ€§
7. **è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£** - æ¯ä¸ªæµ‹è¯•éƒ½æœ‰æ¸…æ™°çš„docstring

---

## ğŸ”„ æ–‡æ¡£åŒæ­¥æ›´æ–°

### ARCHITECTURE.md
- âœ… æ›´æ–°é¡¹ç›®ç»“æ„å›¾ï¼Œæ·»åŠ 4ä¸ªAnthropicæµ‹è¯•æ–‡ä»¶
- âœ… æ›´æ–°schemaéƒ¨åˆ†ï¼Œæ ‡æ³¨messages.pyä¸ºå·²å®Œæˆ
- âœ… æ–°å¢"Anthropic Provider å®ç°è¯¦æƒ…"ç« èŠ‚
  - Schemaç»“æ„è¯´æ˜
  - 48ä¸ªæµ‹è¯•çš„å®Œæ•´åˆ—è¡¨
  - ä¸OpenAIçš„APIå·®å¼‚å¯¹æ¯”
- âœ… æ›´æ–°æ‰©å±•å»ºè®®ï¼Œæ ‡è®°Anthropicä¸ºå·²å®Œæˆ

### README.md
- âœ… æ›´æ–°è¿è¡Œæµ‹è¯•ç¤ºä¾‹ï¼Œæ·»åŠ Anthropicå’ŒGeminiå‘½ä»¤
- âœ… æ›´æ–°æŸ¥çœ‹æŠ¥å‘Šç¤ºä¾‹ï¼Œæ·»åŠ å¤šproviderçš„æŠ¥å‘Šè·¯å¾„
- âœ… æ›´æ–°é¡¹ç›®ç»“æ„å›¾ï¼Œæ ‡æ³¨æµ‹è¯•æ–‡ä»¶æ•°é‡

---

## ğŸš€ ç‰¹æ€§è¦†ç›–

### Anthropic APIæ ¸å¿ƒç‰¹æ€§
- âœ… Messages APIåŸºç¡€åŠŸèƒ½
- âœ… 5ä¸ªä¸»æµæ¨¡å‹æµ‹è¯•
- âœ… é‡‡æ ·å‚æ•°ï¼ˆtemperature/top_p/top_kï¼‰
- âœ… System prompt
- âœ… å¤šè½®å¯¹è¯
- âœ… å¤šæ¨¡æ€ï¼ˆå›¾ç‰‡è¾“å…¥ï¼‰
- âœ… å·¥å…·è°ƒç”¨ï¼ˆTool Useï¼‰
- âœ… æµå¼å“åº”ï¼ˆSSEï¼‰
- âœ… æ€è€ƒæ¨¡å¼ï¼ˆExtended Thinkingï¼‰
- âœ… Metadataè¿½è¸ª

### å¾…æ‰©å±•ç‰¹æ€§ï¼ˆå¯é€‰ï¼‰
- â­ï¸ Prompt Cachingæµ‹è¯•
- â­ï¸ PDFæ–‡æ¡£å¤„ç†
- â­ï¸ Visionèƒ½åŠ›æ·±åº¦æµ‹è¯•
- â­ï¸ Rate limitå¤„ç†

---

## ğŸ“š ä½¿ç”¨æŒ‡å—

### è¿è¡Œæ‰€æœ‰Anthropicæµ‹è¯•
```bash
pytest tests/anthropic/ -v
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
# åŸºç¡€å‚æ•°æµ‹è¯•
pytest tests/anthropic/test_messages_basic.py -v

# é«˜çº§åŠŸèƒ½æµ‹è¯•
pytest tests/anthropic/test_messages_advanced.py -v

# å·¥å…·è°ƒç”¨æµ‹è¯•
pytest tests/anthropic/test_messages_tools.py -v

# æµå¼å“åº”æµ‹è¯•
pytest tests/anthropic/test_messages_streaming.py -v
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# è¿è¡Œæ¨¡å‹å˜ä½“æµ‹è¯•
pytest tests/anthropic/test_messages_basic.py::TestMessagesBasic::test_model_variants -v

# è¿è¡Œå·¥å…·è°ƒç”¨æµ‹è¯•
pytest tests/anthropic/test_messages_tools.py::TestMessagesTools::test_tool_choice_auto -v
```

### æŸ¥çœ‹æŠ¥å‘Š
```bash
# åŸºç¡€å‚æ•°æµ‹è¯•æŠ¥å‘Š
cat reports/anthropic_v1_messages_*.json

# ä½¿ç”¨jqæ ¼å¼åŒ–è¾“å‡º
cat reports/anthropic_v1_messages_*.json | jq .
```

---

## âœ… è´¨é‡ä¿è¯

### ä»£ç è§„èŒƒ
- âœ… éµå¾ªé¡¹ç›®ç»Ÿä¸€çš„ä»£ç é£æ ¼
- âœ… æ¯ä¸ªæµ‹è¯•æœ‰æ¸…æ™°çš„docstring
- âœ… å‚æ•°åœ¨ç±»é¡¶éƒ¨æ˜¾å¼å®šä¹‰
- âœ… ä½¿ç”¨classçº§åˆ«çš„ReportCollector

### æµ‹è¯•è®¾è®¡
- âœ… æ§åˆ¶å˜é‡æ³•ï¼ˆæ¯æ¬¡åªæµ‹ä¸€ä¸ªå‚æ•°ï¼‰
- âœ… å‚æ•°å˜ä½“æµ‹è¯•ï¼ˆparametrizeè£…é¥°å™¨ï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè®°å½•
- âœ… Response SchemaéªŒè¯

### å¯ç»´æŠ¤æ€§
- âœ… æ¨¡å—åŒ–æ–‡ä»¶æ‹†åˆ†
- âœ… æ¸…æ™°çš„æµ‹è¯•é˜¶æ®µåˆ’åˆ†
- âœ… å¤ç”¨çš„å·¥å…·å®šä¹‰ï¼ˆWEATHER_TOOL, CALCULATOR_TOOLï¼‰
- âœ… ä¸€è‡´çš„æµ‹è¯•ç»“æ„

---

## ğŸ“… æ›´æ–°æ—¥æœŸ

2026-01-28

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æ‰©å±•å°†Anthropic Messages APIçš„æµ‹è¯•è¦†ç›–ä»**3ä¸ªåŸºç¡€æµ‹è¯•**æå‡åˆ°**48ä¸ªå…¨é¢æµ‹è¯•**ï¼Œä½¿Anthropicæˆä¸ºllm-specé¡¹ç›®ä¸­æµ‹è¯•è¦†ç›–æœ€å®Œå–„çš„Providerã€‚æµ‹è¯•æ–‡ä»¶é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ï¼Œå®Œå…¨ç¬¦åˆé¡¹ç›®çš„æ¶æ„è§„èŒƒå’Œæœ€ä½³å®è·µã€‚
